// *********************************************************************************
// *****	Author:		Christopher Crews									********
// *****	Date:		10 February 2012									********
// *****	File Name: 	solar.c												********
// *****																	********
// *****	The solar.c file contains all the functions necessary to 		********
// *****	initialize, read, and calculate solar intensity.				********
// *********************************************************************************
// *****             Formated for Monospaced Type							********
#ifdef _GUM

// *********************************************************************************
// *****	Include Statments	 											********
// *********************************************************************************
#include "solar.h"
// ----------  END  ----------------------------------------------------------------

// *********************************************************************************
// *****	Global Variables	 											********
// *********************************************************************************
solar_struct strc_solar;
// ----------  END  ----------------------------------------------------------------


// *********************************************************************************
// *****	Solar_Thread													********
// *****	Continuous thread that reads Solar Sensor						********
// *****	return: void													********
// *****	(1) void pointer												********
// *********************************************************************************
void *Solar_Thread(void *ptr)
{
// *********************************************************************************
// *****	Initialize Variables											********
	solar_struct strc_temp_solar;
// ----------  END  ----------------------------------------------------------------

// *********************************************************************************
// *****	Configure Solar Sensor ADC										********
	//adc_config(v_device,SOLAR_ADDRESS,0x03,0x00);
// ----------  END  ----------------------------------------------------------------
	
// *********************************************************************************
// *****	Main Loop of Solar_Thread										********
	for(;;)
	{
		strc_temp_solar.v_sen_volt = adc_read(v_device,SOLAR_ADDRESS);
		Calculate_Solar(&strc_temp_solar);
		strc_solar = strc_temp_solar;
		new_solar_data = 1;
		usleep(500000);
	}
// ----------  END  Main Solar_Thread Loop  ----------------------------------------
}
// ----------  END  Solar_Thread  --------------------------------------------------



// *********************************************************************************
// *****	Get_Solar_Data													********
// *****	this function is used to get the data out of the 				********
// *****	Solar.c file and back to the calling routine					********
// *****	(r) void														********
// ***** 	(1) solar_struct *: pointer to a solar_struct 					********
// *********************************************************************************
void Get_Solar_Data(solar_struct *temp)
{
	*temp = strc_solar;		// ***** copy data into tmp struct
	new_solar_data = 0;		// ***** set new data flag
}
// ----------  END GET_ALT_DATA  ---------------------------------------------------

// *********************************************************************************
// *****	Save_I2C_device_ID												********
// *****	this functions receives and saves the I2C device ID number		********
// *****	(r) void														********
// ***** 	(1) int: device ID									            ********
// *********************************************************************************
void save_solar_i2c_device_id(int I2C_ID)
{
	v_device = I2C_ID;
	return;
}
// ----------  END SAVE_I2C_DEVICE_ID ----------------------------------------------

// *********************************************************************************
// *****	Calculate_Solar													********
// *****	This functions calculates solar									********
// *****	(r) void														********
// ***** 	(1) solar_struct *: pointer to solar structure  		  	    ********
// *********************************************************************************
void Calculate_Solar(solar_struct *temp)
{
	temp->v_Solar = (double)((SOLAR_M*temp->v_sen_volt + SOLAR_B)*SOLAR_SCALE);
	return;
}
// ----------  END  ----------------------------------------------------------------

// ----------  END  ----------------------------------------------------------------
#endif /* _GUM  */



